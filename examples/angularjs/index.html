import React, { useState } from 'react';

function TodoApp() {
  const [todos, setTodos] = useState([]);
  const [newTodo, setNewTodo] = useState('');

  function addTodo() {
    setTodos([...todos, { title: newTodo, completed: false }]);
    setNewTodo('');
  }

  function toggleCompleted(todo) {
    setTodos(
      todos.map((t) => {
        if (t === todo) {
          return { ...t, completed: !t.completed };
        }
        return t;
      })
    );
  }

  function removeTodo(todo) {
    setTodos(todos.filter((t) => t !== todo));
  }

  function clearCompletedTodos() {
    setTodos(todos.filter((t) => !t.completed));
  }

  const remainingCount = todos.filter((t) => !t.completed).length;

  return (
    <div className="todoapp">
      <header className="header">
        <h1>todos</h1>
        <form onSubmit={addTodo}>
          <input
            className="new-todo"
            placeholder="What needs to be done?"
            value={newTodo}
            onChange={(e) => setNewTodo(e.target.value)}
            autoFocus
          />
        </form>
      </header>
      <section className="main" style={{ display: todos.length ? 'block' : 'none' }}>
        <input
          id="toggle-all"
          className="toggle-all"
          type="checkbox"
          checked={todos.every((t) => t.completed)}
          onChange={(e) =>
            setTodos(
              todos.map((t) => ({
                ...t,
                completed: e.target.checked,
              }))
            )
          }
        />
        <label htmlFor="toggle-all">Mark all as complete</label>
        <ul className="todo-list">
          {todos.map((todo) => (
            <li key={todo.title} className={todo.completed ? 'completed' : ''}>
              <div className="view">
                <input
                  className="toggle"
                  type="checkbox"
                  checked={todo.completed}
                  onChange={() => toggleCompleted(todo)}
                />
                <label onDoubleClick={() => setTodos(todos.map((t) => (t === todo ? { ...t, editing: true } : t)))}>
                  {todo.title}
                </label>
                <button className="destroy" onClick={() => removeTodo(todo)} />
              </div>
              <input
                className="edit"
                value={todo.title}
                onChange={(e) =>
                  setTodos(
                    todos.map((t) => {
                      if (t === todo) {
                        return { ...t, title: e.target.value };
                      }
                      return t;
                    })
                  )
                }
                onBlur={() => setTodos(todos.map((t) => (t === todo ? { ...t, editing: false } : t)))}
                onKeyDown={(e) => {
                  if (e.key === 'Enter') {
                    setTodos(todos.map((t) => (t === todo ? { ...t, editing: false } : t)));
                  }
                }}
              />
            </li>
          ))}
        </ul>
      </section>
      <footer className="footer" style={{ display: todos.length ? 'block' : 'none' }}>
        <span className="todo-count">
          <strong>{remainingCount}</strong> {remainingCount === 1 ? 'item' : 'items'} left
        </span>
        <ul className="filters">
          <li>
            <a href="#/" className="selected">
              All
            </a>
          </li>
          <li>
            <a href="#/active">Active</a>
          </li>
          <li>
            <a href="#/completed">Completed</a>
          </li>
        </ul>
        <button className="clear-completed" onClick={clearCompletedTodos}>
          Clear completed
        </button>
      </footer>
    </div>
  );
}

export default TodoApp;
